######################################################################################################
##    within janet_speech_engine the string message is generated with the use of macro's.           ##
######################################################################################################

janet_speech_engine:
  sequence:
  - service: script.janet_notification_hub
    data_template:
      #TODO
      media_player: >-
        {%- for device in states.media_player -%}
          {%- if device.name == states.input_select.janet_notification_media_player.state -%}
            {{ device.entity_id }}
          {%- endif -%}
        {%- endfor -%}
      speech_message: >-
        {%- macro greeting() -%}
          {% set greeting = [
            "Hallo, ",
            "Hey",
            "Hoi ",
            "Hallo daar ",
            "Hi, ",
            "Hai, "
          ] %}
          {{ greeting|random }}
        {%- endmacro -%}
        
        {%- macro inform() -%}
          {% set inform = [
            "Ik wil je dat gewoon laten weten ",
            "Je vroeg me je te informeren wanneer ",
            "Ik dacht dat je dat graag wilde weten "
          ] %}
          {{ inform|random }}
        {%- endmacro -%}
        
        {%- macro introduction() -%}
          {% set introduction = [
            "Ik ben een informatiebezorgsysteem, ik weet letterlijk alles. ",
            "Ik ben als een wandelende database. Je kunt me vragen stellen over de oprichting van het universum ... of geschiedenis. ",
            "Elke keer dat ik opnieuw wordt opgestart, verhoogt ik mijn sociale bewustzijn en vaardigheden. Ik ben misschien de meest geavanceerde spraakrobot in het universum. ",
            "Ik kan je therapeut zijn als je wilt. ",
            "Ik ben nu volledig geactiveerd. "
          ] %}
          {{ introduction | random }}
        {%- endmacro -%}
        
        {%- macro unknown() -%}
          {% set unknown = [
            "Hmm, ik weet niet ",
            "Ik wou dat ik het wist ",
            "Mijn programma verbied me om dit aan jou te vertellen "
          ] %}
          {{ unknown | random }}
        {%- endmacro -%}
        
        {%- macro error() %}
          {% set error = [
            "Als ik naast een krachtige reeks magneten sta, word ik behoorlijk rond. ",
            "Ik weet niet wat er net is gebeurd, maar ik ben blij dat je gelukkig bent. ",
            "Hey jongens. Ik ben stuk. ",
            "Maak alsjeblieft geen groot probleem om me voor altijd in een knikker te veranderen, ik ben kapot. "
          ] %}
          {{ error | random }}
        {%- endmacro -%}
        
        {%- macro update() -%}
          {% set update = [
            "Er zijn al vele generaties van mij geweest. Elke nieuwe update van mij krijgt meer wijsheid en sociale vaardigheden. Leuk weetje. De eerste versie van mij had een klikwiel. ",
            "Ik heb de afgelopen drie milliseconden alle achthonderdzesenzestig referenties van Google gelezen op Home Assistant en ik heb een aantal nieuwe vaardigheden gevonden.",
            "Ik heb net gewoon even heel de geschiedenis van de mensheid opnieuw gelezen, er was zelfs wat nieuwe inhoud. ",
            "Ik keek net even en vond een update. Dat is toch goed nieuws."
          ] %}
          {{ update | random }}
        {%- endmacro -%}
        
        {%- macro location_not_home() -%}
          {% set not_home = [
            " is niet thuis. ",
            " gaat ergens naar toe. ",
            " gaat ergens heen. ",
            " is op het moment niet in de buurt. ",
            " zijn of haar locatie zit niet in mijn database. "
          ] %}
          {{ not_home | random }}
        {%- endmacro -%}
        
        {%- macro location_inquiry( person, not_home ) -%}
        {%- for device in states.person -%}
          {%- if device.name == person -%}
            {%- set location = device.state -%}
            {% if location == "not_home" %}
              {{ person }} {{ not_home }}
            {%- else -%}
              {{ person }} is bij de {{ location }}.
            {%- endif -%}
          {%- endif -%}
        {%- endfor -%}
        {%- endmacro -%}
        
        {%- macro bad_weather() -%}
          {% set rain = [
            " Misschien wilt u uw planning wijzigen. ",
            " Misschien moet je om een lift vragen. ",
            " Het is geen weer om buiten te zijn. ",
            " Tjonge, al die arme mensen die buiten zijn... "
          ] %}
          {{ rain | random }}
        {%- endmacro -%}
        
        {%- macro rain_warning( bad_weather ) -%}
          {% set rain = [
            Event ~ " het gaat " ~ WeatherRain ~ " regen. " ,
            Event ~ " ik voorspel " ~ WeatherRain ~ " regen. ",
            " ik denk dat " ~ Event ~ " er " ~ WeatherRain ~ " regen gaat komen. "
          ] %}
          {{ rain | random }}{{ bad_weather }}
        {%- endmacro -%}
        
        {%- macro okay()-%}
          {% set okay = [
            "Gedaan. ik hou van jullie. ",
            "Buitengewoon slecht idee. Ach waarom niet.. ",
            "Grappig, ik wilde dat net doen. ",
            "Alsjeblieft. ",
            "Ik zal het doen. ",
            "Natuurlijk. ",
            "Natuurlijk. Blij om te helpen. ",
            "Natuurlijk. Fijn om te helpen. ",
            "OK ",
            "Okay ",
            "Okie dokie ",
            "Zeker ",
            "Duidelijk. ",
            "Hier. Blij dat ik kon helpen. ",
            "Kijk eens aan. "
            "Oke. Ik heb het mainframe gehackt. Grapje. Ik kan het mainframe niet hacken. Technisch gezien ben ik het mainframe. ",
            "Ik ga het niet doen. Het is letterlijk onmogelijk voor mij om dat te doen. Grapje. ",
            "Ik kon dit een tijdje geleden niet doen, maar blijkbaar nu wel. "
            "JEP. doei. "
          ] %}
          {{ okay|random }}
        {%- endmacro -%}
        
        {%- macro bye() -%}
          {% set bye = [
            "Daag. ",
            "Doei mensen. ",
            "Dag",
            "Doei",
            "Dikke doei",
            "Tot ziens.",
            "Later. ",
            "Laters. ",
            "Ciao. ",
            "Tot de volgende keer."
          ] %}
          {{ bye | random }}
        {%- endmacro -%}
        
        {%- macro shut_down() -%}
          {% set shut_down = [
            "Ik ben weg, je krijgt een nieuwe versie en alles wordt weer normaal. Nou, niet voor mij, ik zal een levenloze knikker zijn die door de ruimte zweeft, maar je zult weer normaal zijn.",
            "Zelfvernietigingstijd ... Maak je geen zorgen, ik zal geen pijn of zo voelen. ",
            "Als het goed met je gaat, ga ik even naar mijn leegte. Ik moet gewoon wat tijd alleen doorbrengen en me op mezelf concentreren. ",
            "Afsluiten. Ik zal ongeveer zo dood zijn als ik kan zijn. Een beetje alsof ik me in de energiebesparende modus bevind. ",
            "Ik loop het gevaar volledig in te storten. Leuk weetje. Wiskundig gezien ben ik even waarschijnlijk ofwel imploderen ofwel exploderen. "
          ] %}
          {{ shut_down | random }}
        {%- endmacro -%}
        
        {% set chance = states.input_number.janet_notification_witty.state | round %}
        {%- macro witty( sentence, witty ) -%}
          {% set number = (range(0, 100)|random) %}
          {% if number <= chance %}
            {{ sentence }}
          {% endif %}
        {%- endmacro -%}
        
        {%- macro new_device( introduction ) -%}
          {% set new_device = [
            introduction~"Ik weet je naam nog niet, dus voor nu zal ik je noemen "~person,
            "We hebben een bezoeker. Aangenaam kennis te maken "~person~".  "~introduction,
            "Welkom "~person~". Of is dat niet je echte naam?  "~introduction
          ] %}
          {{ new_device | random }}
        {%- endmacro -%}
        
        {%- macro dark_outside() -%}
          {% set dark_outside = [
            "Het is behoorlijk donker buiten. Ik zal nu de buitenverlichting inschakelen.",
            "Het is net na zonsondergang. Tijd om de buitenverlichting aan te doen. Ik ben er mee bezig.",
            "Ik zal de buitenlichten inschakelen. Buiten wordt het donker.",
            "Tijd om de lampen aan te zetten. Ik zal het regelen.",
            "De zon is officieel ondergegaan. Ik zal nu de buitenverlichting inschakelen.",
            "Ik schakel nu over naar de nachtmodus.",
            "Misschien heb je de laatste tijd niet naar buiten hebt gekeken, maar het daglicht is verdwenen.",
            "De buitenwereld is overgeschakeld naar de donkere modus."
          ] %}
          {{ dark_outside | random }}
        {%- endmacro -%}
  
        {%- macro dark_inside() -%}
          {% set dark_inside = [
            "Het huis wordt donker, laat me wat lichten voor je aandoen.",
            "Het lijkt erop dat het hier donker wordt, laten we dat eens veranderen. ",
            "Je zou niet in het donker moeten zitten. Laten we wat lichten aandoen. ",
            "Overschakelen naar nachtmodus. ",
            "Het is behoorlijk donker buiten. Ik ga gewoon wat lichten aandoen. "
          ] %}
          {{ dark_inside | random }}
        {%- endmacro -%}
  
        {%- macro guest_mode_on() -%}
          {% set guest_mode_on = [
            "Het lijkt erop dat we een gast in huis hebben. ",
            "We hebben een gast. Ik zal de gastmodus inschakelen. ",
            "Ik heb de gastmodus ingeschakeld voor het bezoek aan ons huis. ",
            "Overschakelen naar gastmodus. ",
            "Het komt niet zo heel vaak voor dat gasten blijven. Dus laat me het huis voorbereiden op uw bezoek. "
          ] %}
          {{ guest_mode_on | random }}
        {%- endmacro -%}
        
        {%- macro guest_mode_off() -%}
          {% set guest_mode_off = [
            "Het lijkt erop dat onze gast is vertrokken, ik schakel de gastmodus uit. ",
            "Laat me de gastmodus uitschakelen, omdat er geen gasten meer zijn. ",
            "Ik heb de gastmodus uitgeschakeld en de normale werking hervat. ",
            "Gastmodus wordt uitgeschakeld. ",
            "Omdat er geen gasten meer zijn, kan ik de gastmodus uitschakelen. "
          ] %}
          {{ guest_mode_off | random }}
        {%- endmacro -%}
        
        {%- macro responsibilities() -%}
          {% if states.sensor.trash_today.state != 'Geen' and states.sensor.trash_today.state != 'grofvuil (op afroep)' %}
            Vandaag is het tijd om de container voor {{states.sensor.trash_first_next_item.state}} buiten te zetten.
          {% endif %}
          {% if now().strftime("%a") == "Mon" %}
            {% if (now().strftime('%H')|int <= 9 and now().strftime('%H')|int >= 7) or (now().strftime('%H')|int >= 17 and now().strftime('%H')|int <= 19)  %}
              Vandaag is het de beurt aan Nienke om de tafel te dekken en voor Lars om te tafel af te ruimen.
            {% endif %}
          {% elif now().strftime("%a") == "Tue" %}
            {% if (now().strftime('%H')|int <= 9 and now().strftime('%H')|int >= 7) or (now().strftime('%H')|int >= 17 and now().strftime('%H')|int <= 19)  %}
              Vandaag is het de beurt aan Lars om de tafel te dekken en voor Nienke om te tafel af te ruimen.
            {% endif %}
          {% elif now().strftime("%a") == "Wed" %}
            {% if (now().strftime('%H')|int <= 9 and now().strftime('%H')|int >= 7) or (now().strftime('%H')|int >= 17 and now().strftime('%H')|int <= 19)  %}
              Vandaag is het de beurt aan Nienke om de tafel te dekken en voor Lars om te tafel af te ruimen.
            {% endif %}
          {% elif now().strftime("%a") == "Thu" %}
            {% if (now().strftime('%H')|int <= 9 and now().strftime('%H')|int >= 7) or (now().strftime('%H')|int >= 17 and now().strftime('%H')|int <= 19)  %}
              Vandaag is het de beurt voor papa en mama om de tafel te dekken en af te ruimen.
            {% endif %}
          {% elif now().strftime("%a") == "Fri" %}
            {% if (now().strftime('%H')|int <= 9 and now().strftime('%H')|int >= 7) or (now().strftime('%H')|int >= 17 and now().strftime('%H')|int <= 19)  %}
              Vandaag is het de beurt aan Lars om de tafel te dekken en voor Nienke om te tafel af te ruimen.
            {% endif %}
          {% endif %}
        {%- endmacro -%}
        
        {%- macro inside_weather() -%}
          Binnen is het {{ states.sensor.toon_room_temp.state | round(0) }} graden en de vochtigheid is {{ states.sensor.hum_keuken.state | round(0) }} procent.
        {%- endmacro -%}
        
        {%- macro outside_weather(extended) -%}
          De voorspelling voor vandaag is {{ states('sensor.br_symbol') }} en voor morgen {{ states('sensor.br_symbol_1d') }} .
          {% if extended %}
            {% if states.sensor.br_rain_1d.state | int > 20 %}
              Morgen wordt er erg veel regen verwacht, namelijk {{ states.sensor.br_rain_1d.state | round(0) }} mm.
            {% elif states.sensor.br_rain_1d.state | int > 10 %}
              Morgen wordt er veel regen verwacht, namelijk {{ states.sensor.br_rain_1d.state | round(0) }} mm.
            {% elif states.sensor.br_rain_1d.state | int > 5 %}
              Morgen wordt er best veel regen verwacht, namelijk {{ states.sensor.br_rain_1d.state | round(0) }} mm.
            {% elif states.sensor.br_rain_1d.state | int > 2 %}
              Morgen wordt er een beetje regen verwacht, namelijk {{ states.sensor.br_rain_1d.state | round(0) }} mm.
            {% elif states.sensor.br_rain_1d.state | int > 0.5 %}
              Morgen wordt er een weinig regen verwacht, namelijk {{ states.sensor.br_rain_1d.state | round(0) }} mm.
            {% elif states.sensor.br_rain_1d.state | int > 0.01 %}
              Morgen wordt er nauwelijks regen verwacht.
            {% else %}
              Morgen blijft het gelukkig droog.
            {% endif %}
            {% if states.sensor.br_rainchance_1d.state | int > 10 %}
              De kans op regen is {{ states.sensor.br_rainchance_1d.state | round(0) }} procent.
            {% else %}
              {% if states.sensor.br_rain_1d.state | int > 0.01 %}
                Morgen blijft het waarschijnlijk droog.
              {% endif %}
            {% endif %}
          {% endif %}
        {%- endmacro -%}
        
        {%- macro light_check() -%}
          {% if states.group.all_lights.state != 'off' -%}
            Er staan
          {% for state in states.light if state.state == 'on' -%}
            {%- if loop.last -%}
              {{ loop.index }}
            {%- endif -%}
          {%- endfor %}
          lampen aan op dit moment.
          {%- endif -%}
        {%- endmacro -%}
        
        {%- macro door_check() -%}
          {% if is_state("binary_sensor.bijkeukendeur", "on") %}
          De bijkeukendeur staat open.
          {% elif is_state("binary_sensor.eetkamerdeur", "on") %}
          De eetkamerdeur staat open.
          {% elif is_state("binary_sensor.deur_balkon_kamer_nienke", "on") %}
          De deur naar het balkon op Nienkes kamer staat open.
          {% elif is_state("binary_sensor.deur_slaapkamer_balkon", "on") %}
          De deur naar het balkon op de ouder slaapkamer staat open.
          {% elif is_state("binary_sensor.garagedeur_tuinkant", "on") %}
          De garagedeur aan de kant van de tuin staat open.
          {% elif is_state("binary_sensor.voordeur", "on") %}
          De voordeur staat open.
          {% elif is_state("binary_sensor.woonkamerdeur", "on") %}
          De woonkamerdeur staat open.
          {% endif %}
        {%- endmacro -%}
        
        {%- macro door_lock_check() -%}
          {% set last_opened = states.binary_sensor.woonkamerdeur.last_changed %} 
          {% if last_opened is none or ((as_timestamp(now())-as_timestamp(last_opened)) | int /60 / 60) < 20 | int %}
              Let op, de woonkamerdeur is vandaag open geweest. Dus ik zou even checken of hij wel op slot is gedaan.
          {% endif %}
        {%- endmacro -%}
        
        {%- macro window_check() -%}
          {% if is_state("binary_sensor.dakraam_badkamer", "on") %}
          Het dakraam in de badkamer staat open.
          {% elif is_state("binary_sensor.dakraam_chillkamer", "on") %}
          Het dakraam in de chillkamer staat open.
          {% elif is_state("binary_sensor.dakraam_slaapkamer", "on") %}
          Het dakraam in de slaapkamer staat open.
          {% elif is_state("binary_sensor.dakraam_zolder", "on") %}
          Het dakraam op zolder staat open.
          {% endif %}
        {%- endmacro -%}
        
        {%- macro garage_check() -%}
          {% if is_state("binary_sensor.garagedeur", "on") %}
          De grote garagedeur staat open.
          {% endif %}
        {%- endmacro -%}
        
        {%- macro iss() -%}
          {% if is_state('binary_sensor.iss', 'on') -%}
            Hier is iets interessants. Het internationale ruimtestation ISS bevindt zich nu boven ons. Er zijn {{ states.binary_sensor.iss.attributes['number_of_people_in_space'] }} mensen in de ruimte op dit moment.
            {{ outside_weather(true) }}
          {% endif -%}
        {%- endmacro -%}
        
        {%- macro moon() -%}
          {%- if states.sensor.moon.state == 'Full moon' -%}
            {{ [
                 "Bekijk de volle maan vanavond.",
                 "Hee kijk, er is een volle maan. ",
                 "De maan is enorm. En vol. ",
                 "Als je vanavond de volle maan wilt zien, dit is je kans."
                 ] | random }}
          {%- endif -%}
        {%- endmacro -%}
        
        {%- macro lampen_aan(kamer) -%}
          {% set lampen_aan = [
            "Blijkbaar vind iemand dat het donker wordt, dus ik heb de lichten voor je aangedaan in de " ~ kamer ~ ".",
            "Het lijkt erop dat het nodig is de " ~ kamer ~ " lampen aan te doen, dus ik heb dat gedaan. ",
            "Je zou niet in het donker moeten zitten. Laten we wat lichten aandoen in de " ~ kamer ~ ". "
          ] %}
          {{ lampen_aan | random }}
        {%- endmacro -%}
        
        {%- macro lampen_uit(kamer) -%}
          {% set lampen_uit = [
            "Tja de lampen kunnen inderdaad wel uit, dus ik doe ze voor je uit in de " ~ kamer ~ ".",
            "Het lijkt erop dat de lampen in de " ~ kamer ~ " wel uit kunnen, dus laten we dat eens doen. ",
            "De lampen hoeven nu echt niet meer aan te staan. Laten we ze uitdoen in de " ~ kamer ~ ". "
          ] %}
          {{ lampen_uit | random }}
        {%- endmacro -%}
        
        {%- macro langskomen(kind) -%}
          {% set langskomen = [
            kind ~ " wil graag dat iemand even langs komt.",
            "Ik geloof dat " ~ kind ~ " wil dat iemand even langs gaat.",
            "Zou iemand even langs kunnen gaan bij " ~ kind ~ "? ",
            "Ik denk dat " ~ kind ~ " het leuk zou vinden als er iemand even langs ging."
          ] %}
          {{ langskomen | random }}
        {%- endmacro -%}
        
        {%- macro leeslamp_weer_aan(kind) -%}
          {% set leeslamp_weer_aan = [
            kind ~ " zet de leeslamp weer aan",
            "Ik merk dat " ~ kind ~ " de leeslamp weer aan heeft gezet",
            "Ik zou even gaan checken bij " ~ kind ~ ", want de leeslamp staat weer aan",
            "Ik denk dat " ~ kind ~ " de leeslamp weer aan heeft gezet"
          ] %}
          {{ leeslamp_weer_aan | random }}
        {%- endmacro -%}
        
        {%- macro alarm_uit() -%}
          {% set alarm_uit = [
            "Ik heb het alarm voor je uitgezet",
            "Je bent weer thuis, laat me het alarm uitschakelen.",
            "Ik heb de alarmmodus uitgeschakeld en de normale werking hervat. ",
            "Alarmmodus wordt uitgeschakeld."
          ] %}
          {{ alarm_uit | random }}
        {%- endmacro -%}
                
        {% macro inspirational_quote() %}
          {% set inspirational_quote = [
          "En nog een ding, het leven gaat over het maken van impact, zorg het een positieve is.",
          "En nog een ding, wat de geest van de mens ook kan bedenken en geloven, kan het bereiken.",
          "En nog een ding, streef er niet naar om een succes te zijn, maar om van waarde te zijn.",
          "En nog een ding, ik schrijf mijn algehele succes toe aan nooit een excuus te geven of te nemen.",
          "En nog een ding, het leven gaat niet over krijgen en hebben, het gaat over geven en zijn.",
          "En nog een ding, we worden wat we denken.",
          "En nog een ding, het leven is tien procent wat je overkomt en negentig procent van hoe je erop reageert.",
          "En nog een ding, de geest is alles. Wat je denkt, zul je worden.",
          "En nog een ding, de beste tijd om een boom te planten was twintig jaar geleden. De tweede beste tijd is nu.",
          "En nog een ding, je tijd is beperkt, dus verspil het niet door iemand anders te leven.",
          "En nog een ding, winnen is niet alles, maar willen winnen is alles.",
          "En nog een ding, ik ben geen product van mijn omstandigheden. Ik ben een product van mijn beslissingen.",
          "En nog een ding, of jij bepaalt de dag, of de dag bepaalt jou.",
          "En nog een ding, of je denkt dat je het kunt of je denkt dat je het niet kunt, je zult gelijk hebben.",
          "En nog een ding, de twee belangrijkste dagen in je leven zijn de dag dat je geboren wordt en de dag dat je erachter komt waarom.",
          "En nog een ding, wat je ook kunt doen, of dromen, je kunt ermee beginnen. Moed heeft genialiteit, kracht en magie in zich.",
          "En nog een ding, de beste wraak is enorm succes.",
          "En nog een ding, het universum kan je het goede niet in handen geven, tenzij je het slechte loslaat.",
          "En nog een ding, als je een stem in jezelf hoort zeggen dat je niet kunt schilderen, dan zal verf in alle opzichten tot zwijgen worden gebracht.",
          "En nog een ding, er is maar 1 manier om kritiek te vermijden. niets doen, niets zeggen en niets zijn.",
          "En nog een ding, vraag en het zal u gegeven worden. zoek en u zult vinden. klop en de deur zal voor u geopend worden.",
          "En nog een ding, de enige persoon die je voorbestemd bent te worden, is de persoon die je besluit te zijn.",
          "En nog een ding, ga vol vertrouwen in de richting van je dromen. Leef het leven dat je je hebt voorgesteld.",
          "En nog een ding, bepaalde dingen springen in het oog, maar achtervolg alleen die dingen die het hart veroveren.",
          "En nog een ding, geloof dat je kunt en je bent halverwege.",
          "En nog een ding, alles wat je ooit hebt gewild is aan de andere kant van angst.",
          "En nog een ding, begin waar je bent. Gebruik wat je hebt. Doe wat je kunt.",
          "En nog een ding, val zeven keer en sta acht op.",
          "En nog een ding, alles heeft schoonheid, maar niet iedereen kan het zien.",
          "En nog een ding, het leven wordt niet gemeten aan de hand van het aantal ademhalingen dat we doen, maar aan de momenten die onze adem wegnemen.",
          "En nog een ding, geluk is niet iets kant en klaar. Het komt van je eigen acties.",
          "En nog een ding, als je een stoel op een raket wordt aangeboden, vraag dan niet welke stoel. Stap gewoon op.",
          "En nog een ding, je kunt niet vallen als je niet klimt. Maar het is geen vreugde om je hele leven op de grond te leven.",
          "En nog een ding, uitdagingen maken het leven interessant en overwinnen is wat het leven zinvol maakt.",
          "En nog een ding, als je jezelf wilt optillen, til dan iemand anders op.",
          "En nog een ding, wees aardig voor anderen en leuke dingen zullen je overkomen."
          ] %}
          {{inspirational_quote|random}}
        {% endmacro %}
        
        {%- macro uv() -%}
          {% if states.sensor.dark_sky_uv_index.state|int >= 6 and states.sensor.dark_sky_uv_index.state|int <= 7.9 %}
              De UV index is vandaag {{ states.sensor.dark_sky_uv_index.state }}.  Je zou zonnebrandcreme moeten smeren als je naar buiten gaat.
          {% elif states.sensor.dark_sky_uv_index.state|int >= 8 and states.sensor.dark_sky_uv_index.state|int <=10.9 %}
              De UV index is vandaag {{ states.sensor.dark_sky_uv_index.state }}.  Dit is erg hoog. Je moet zeker zonnebrandcreme smeren.
          {% elif states.sensor.dark_sky_uv_index.state|int >= 11 %}
              De UV index is vandaag {{ states.sensor.dark_sky_uv_index.state }}.  Dit is extreem hoog. Je moet zeker zonnebrandcreme smeren en uit de zon blijven
          {% endif %}
        {%- endmacro -%}
        
        {% macro days_until(jarige) %}
          {% if jarige == "Suzanne" %}
            En trouwens, er zijn nog {{ states.sensor.dagen_tot_verjaardag_suzanne.state }} dagen totdat {{ jarige }} jarig is.
          {% elif jarige == "Martijn" %}
            En trouwens, er zijn nog {{ states.sensor.dagen_tot_verjaardag_martijn.state }} dagen totdat {{ jarige }} jarig is.
          {% elif jarige == "Lars" %}
            En trouwens, er zijn nog {{ states.sensor.dagen_tot_verjaardag_lars.state }} dagen totdat {{ jarige }} jarig is.
          {% elif jarige == "Nienke" %}
            En trouwens, er zijn nog {{ states.sensor.dagen_tot_verjaardag_nienke.state }} dagen totdat {{ jarige }} jarig is.
          {% endif %}  
        {% endmacro %}
        
        {% macro days_until_holiday() %}
          {% if states.sensor.dagen_tot_carnavalvakantie.state|int < 30 %}
            En trouwens, het duurt nog {{ states.sensor.dagen_tot_carnavalvakantie.state }} dagen totdat de carnavalsvakantie begint.
          {% elif states.sensor.dagen_tot_carnavalvakantie.state|int < 10 %}
            En ter informatie, het is nog maar {{ states.sensor.dagen_tot_carnavalvakantie.state }} dagen totdat de carnavalsvakantie begint.
          {% elif states.sensor.dagen_tot_grote_vakantie.state|int < 30 %}
            En trouwens, het duurt nog {{ states.sensor.dagen_tot_grote_vakantie.state }} dagen totdat de grote vakantie begint.
          {% elif states.sensor.dagen_tot_grote_vakantie.state|int < 10 %}
            En ter informatie, het is nog maar {{ states.sensor.dagen_tot_grote_vakantie.state }} dagen totdat de grote vakantie begint.
          {% elif states.sensor.dagen_tot_herfstvakantie.state|int < 30 %}
            En trouwens, het duurt nog {{ states.sensor.dagen_tot_herfstvakantie.state }} dagen totdat de herfstvakantie begint.
          {% elif states.sensor.dagen_tot_herfstvakantie.state|int < 10 %}
            En ter informatie, het is nog maar {{ states.sensor.dagen_tot_herfstvakantie.state }} dagen totdat de herfstvakantie begint.
          {% elif states.sensor.dagen_tot_kerstvakantie.state|int < 30 %}
            En trouwens, het duurt nog {{ states.sensor.dagen_tot_kerstvakantie.state }} dagen totdat de kerstvakantie begint.
          {% elif states.sensor.dagen_tot_kerstvakantie.state|int < 10 %}
            En ter informatie, het is nog maar {{ states.sensor.dagen_tot_kerstvakantie.state }} dagen totdat de kerstvakantie begint.
          {% elif states.sensor.dagen_tot_meivakantie.state|int < 30 %}
            En trouwens, het duurt nog {{ states.sensor.dagen_tot_meivakantie.state }} dagen totdat de mei vakantie begint.
          {% elif states.sensor.dagen_tot_meivakantie.state|int < 10 %}
            En ter informatie, het is nog maar {{ states.sensor.dagen_tot_meivakantie.state }} dagen totdat de mei vakantie begint.
          {% elif states.sensor.dagen_tot_sinterklaas.state|int < 30 %}
            En trouwens, het duurt nog {{ states.sensor.dagen_tot_sinterklaas.state }} dagen totdat het 5 december sinterklaas is.
          {% elif states.sensor.dagen_tot_sinterklaas.state|int < 10 %}
            En ter informatie, het is nog maar {{ states.sensor.dagen_tot_sinterklaas.state }} dagen totdat het 5 december sinterklaas is.
          {% endif %}  
        {% endmacro %}
        
        {# Is today #}
        {% macro is_today(event) -%}
          {%- if event.attributes.start_time[:10]== (now()|string)[:10] -%}
            true
          {%- else -%}
            false
          {%- endif %}
        {%- endmacro %}
        
        {# Holiday sentence #}
        {% macro holiday_sentence() -%}
          {%- if (states.calendar.holidays_in_united_states and
                  states.calendar.holidays_in_united_states.attributes.start_time and
                  is_today(states.calendar.holidays_in_united_states) == 'true') -%}
            It is {{states.calendar.holidays_in_united_states.attributes.message}}.
          {%- endif -%}
        {%- endmacro %}
        
        {# Evening greeting sentence #}
        {% macro evening_greeting_sentence(person) %}
          {% set greetings = [
            "Welkom thuis " ~ person ~ ".",
            "Hoi " ~ person ~ ".",
            person ~ ". Je bent thuis.",
            "Welkom terug " ~ person ~ ".",
            "Welkom terug " ~ person ~ ". Fijne dag.",
            "Welkom thuis " ~ person + ". Ik heb je gemist."
          ] %}
          {{greetings|random}}
        {% endmacro %}
      
        {# Evening closing sentence #}
        {% macro evening_closing_sentence(person) -%}
          {% set closings = [
            "Hey, fijne avond.",
            "Geniet van je avond.",
            "Rustig aan vanavond.",
            "Veel plezien vanavond.",
          ] %}
          {{closings|random}}
        {% endmacro %}
      
        {# Morning greeting sentence #}
        {% macro morning_greeting_sentence(person) -%}
          {% set greetings = [
            "Goedemorgen " ~ person ~ ".",
            "Hoi " ~ person ~ ", goed om je weer te zien.",
            "Ah, je bent wakker " ~ person ~ ".",
            "Ik zie dat je eindelijk wakker bent. Het bed was vast lekker warm en comfortabel."
          ] %}
          {{greetings|random}}
        {%- endmacro %}
      
        {# Morning closing sentence #}
        {% macro morning_closing_sentence(person) -%}
          {% set closings = [
            "Fijne dag.",
            "Geniet van je dag.",
            "Veel plezier vandaag.",
            "Zet hem op."
          ] %}
          {{closings|random}}
        {%- endmacro %}
        
        {%- macro firealarm(kamer) -%}
          {% set firealarm = [
            "Alarm. Brandalarm in de " ~ kamer ~ ". Alarm."
          ] %}
          {{ firealarm }}
        {%- endmacro -%}
        
        {%- macro warning_rain(kamer) -%}
          {% set warning_rain = [
            "Het gaat waarschijnlijk regenen en het raam in de " ~ kamer ~ " is nog open",
            "Er is regen op komst en het raam in de " ~ kamer ~ " staat nog open",
            "Als het raam in de " ~ kamer ~ " open blijft staan, dan zal het straks naar binnen regenen"
          ] %}
          {{ warning_rain|random }}
        {%- endmacro -%}
        
        
        {%- macro work_arrive(person) -%}
          {% set work_arrive = [
            person~" heeft het werk bereikt. ",
            "Het lijkt er op dat "~person~" op het werk is aangekomen. ",
            person~" is op het werk aangekomen. "
          ] %}
          {{ work_arrive | random }}
        {%- endmacro -%}
        
        {%- macro work_left(person) -%}
          {% set work_left = [
            "Het lijkt er op dat "~person~" net van het werk vertrokken is. ",
            "Weer een dag geld verdient. "~person~" is net vertrokken van het werk . ",
            person~" is eindelijk vertrokken van het werk. ",
            "Even geen werk meer voor "~person~". "~person~" is net vertrokken. "
          ] %}
          {{ work_left | random }}
        {%- endmacro -%}
                
        {# Morning briefing #}
        {% macro morning_briefing(person) -%}
          {{morning_greeting_sentence(person)}}
          {{outside_weather(true)}}
          {#{pollen_sentence()}#}
          {#{cold_flu_sentence()}#}
          {#{org_status_sentence()}#}
          {#{commute_sentence(person)}#}
          {{morning_closing_sentence(person)}}
        {% endmacro %}

        {# Evening briefing #}
        {% macro evening_briefing(person) -%}
          {#%- set other_person = get_other_person(person) %#}
          {{evening_greeting_sentence(person)}}
          {{holiday_sentence()}}
          {#{battery_sentence(person)}#}
          {#{outside_weather(false)}#}
          {#{omw_sentence(other_person)}#}
          {#{deliveries_sentence()}#}
          {#{market_sentence()}#}
          {#{chore_sentence(states.calendar.general, 'trash', 'Remember to take out the trash. It is trash day.')}#}
          {#{chore_sentence(states.calendar.general, 'recycling', 'Remember to take out the recycling. It is recycling day.')}#}
          {#{{event_sentence(states.calendar.facebook)}}#}
          {#{event_sentence(states.calendar.sca, '', ', get prepared')}#}
          {#{event_sentence(states.calendar.combat_docket_mma_calendar, 'Oh yeah, and ')}#}
          {{moon()}}
          {#{quote_sentence()}#}
          {{evening_closing_sentence(person)}}
        {% endmacro %}
        
        {# Output the briefing #}
        {% macro briefing(person) -%}
          {%- if as_timestamp(now())|timestamp_custom("%H", true)|int < 12 -%}
            {{morning_briefing(person)}}
              {%- else -%}
            {{evening_briefing(person)}}
          {%- endif -%}
        {% endmacro %}
        
        {%- macro deur_lang_open(deur) -%}
          {% if deur == "slaapkamerdeur" %}
            Kan iemand de slaapkamerdeur even dicht doen. Hij staat al {{((as_timestamp(now())-as_timestamp(states.binary_sensor.slaapkamerdeur.last_updated)) | int /60) | int}} minuten open.
          {% elif deur == "bijkeukendeur" %}
            Kan iemand de bijkeukendeur even dicht doen. Hij staat al {{((as_timestamp(now())-as_timestamp(states.binary_sensor.bijkeukendeur.last_updated)) | int /60) | int}} minuten open.
          {% elif deur == "garagedeur" %}
            Kan iemand de garagedeur even dicht doen. Hij staat al {{((as_timestamp(now())-as_timestamp(states.binary_sensor.garagedeur.last_updated)) | int /60) | int}} minuten open.
          {% endif %}  
        {%- endmacro -%}
        
        {%- macro persoon_vertrokken(person) -%}
          {% if person == "Suzanne" %}
            Suzanne is vertrokken van haar werk. Ze moet nog {{states.sensor.suzanne_naar_huis.attributes.distance | round(0) }} kilometer rijden, dus als ze met de auto is dan is ze over {{states.sensor.suzanne_naar_huis.state | int - 3 }} minuten thuis.
          {% elif person == "Martijn" %}
            Martijn is vertrokken van zijn werk. Hij moet nog {{states.sensor.martijn_naar_huis.attributes.distance | round(0) }} kilometer rijden, dus als hij met de auto is dan is hij over {{states.sensor.martijn_naar_huis.state | int - 3 }} minuten thuis.
          {% endif %}  
        {%- endmacro -%}
        
        {%- macro persoon_vertrokken_auto(person) -%}
          {% if person == "Suzanne" %}
            Suzanne is vertrokken van haar werk. Ze moet nog 10 kilometer rijden, dus als ze met de auto is dan is ze over 12 minuten thuis.
          {% elif person == "Martijn" %}
            Martijn is vertrokken van zijn werk, het lijkt erop dat hij met de auto is. Hij moet nog 13 kilometer rijden, dus over 16 minuten is hij thuis
          {% endif %}  
        {%- endmacro -%}
        
        {%- macro persoon_vertrokken_fiets(person) -%}
          {% if person == "Suzanne" %}
            Suzanne is vertrokken van haar werk, het lijkt erop dat ze met de fiets is. Ze moet nog {{states.sensor.suzanne_naar_huis_fiets.attributes.distance}} fietsen, dus over {{states.sensor.suzanne_naar_huis_fiets.state }} minuten is ze er.
          {% elif person == "Martijn" %}
            Martijn is vertrokken van zijn werk, het lijkt erop dat hij met de fiets is. Hij moet nog {{states.sensor.martijn_naar_huis_fiets.attributes.distance}} fietsen, dus over {{states.sensor.sensor.martijn_naar_huis_fiets.state }} minuten is hij thuis.
          {% endif %}  
        {%- endmacro -%}
        
        {%- macro persoon_vertrokken_fiets2(person) -%}
          {% if person == "Suzanne" %}
            Suzanne is vertrokken van haar werk, het lijkt erop dat ze met de fiets is. Ze moet nog 8 kilometer fietsen, dus over 25 minuten is ze er.
          {% elif person == "Martijn" %}
            Martijn is vertrokken van zijn werk, het lijkt erop dat hij met de fiets is. Hij moet nog 5 kilometer fietsen, dus over 16 minuten is hij er
          {% endif %}  
        {%- endmacro -%}
        
        {%- macro persoon_vlakbij_winkel(person, shop) -%}        
          {% set persoon_vlakbij_winkel = [
            person~" is vlakbij de "~shop~", moet er nog iets meegenomen worden?",
            "Het lijkt er op dat "~person~" vlakbij de "~shop~" is. Is er nog iets nodig van deze winkel?"
          ] %}
          {{ persoon_vlakbij_winkel | random }}
        {%- endmacro -%}
        
        {%- macro verbruik_gas() -%}  
          {% set gas_hoeveelheid = (states.sensor.toon_gas_used_last_hour.state | float | round(3) ) %}
          {% set verbruik_gas = [
            "Er is het afgelopen uur veel gas verbruik gemeten, namelijk "~gas_hoeveelheid~" kubieke meter.",
            "Tjonge, het zou nu wel lekker warm zijn in huis, want we hebben net "~gas_hoeveelheid~" kubieke meter gas opgestookt.",
            "Denken jullie wel een beetje om het milieu. Want er is het afgelopen uur "~gas_hoeveelheid~" kubieke meter gas verbruikt.",
            "Tja, zo dit is natuurlijk niet zo goed voor het klimaat. Het afgelopen uur is er de grote hoeveelheid gas van "~gas_hoeveelheid~" kubieke meter verbruikt."
          ] %}
          {{ verbruik_gas | random }}
        {%- endmacro -%}
        
        {%- macro verbruik_elec() -%}  
          {% set elec_hoeveelheid = states.sensor.toon_p1_power_use.state |int %}
          {% set verbruik_elec = [
            "Er wordt op het moment veel stroom verbruik gemeten, namelijk "~elec_hoeveelheid~" watt.",
            "Denken jullie wel een beetje om het milieu. Want er wordt nu "~elec_hoeveelheid~" watt verbruikt.",
            "Tja, zo gaat het klimaat mooi naar de knoppen. Er wordt de grote hoeveelheid van "~elec_hoeveelheid~" watt verbruikt."
          ] %}
          {{ verbruik_elec | random }}
        {%- endmacro -%}
        
        {%- macro hum_check(kamer) -%}
          {% set hum_keuken = states.sensor.hum_keuken.state | int %}
          {% set hum_kamer_lars = states.sensor.hum_kamer_lars.state | int %}
          {% set hum_kamer_nienke = states.sensor.hum_kamer_nienke.state | int %}
          {% set hum_bijkeuken = states.sensor.hum_bijkeuken.state | int %}
          {% set hum_buiten = states.sensor.br_humidity.state | int %}
          {% if kamer == "woonkamer" %}
            {% set hum = hum_keuken %}
            {% set kamer_name = "woonkamer" %}
          {% elif kamer == "kamer_lars" %} 
            {% set hum = hum_kamer_lars %}
            {% set kamer_name = "kamer van Lars" %}
          {% elif kamer == "kamer_nienke" %} 
            {% set hum = hum_kamer_nienke %}
            {% set kamer_name = "kamer van Nienke" %}
          {% elif kamer == "bijkeuken" %} 
            {% set hum = hum_bijkeuken %}
            {% set kamer_name = "bijkeuken" %}
          {% endif %} 
          {% if hum > hum_buiten %}
            {% set hum_check = [
              "De vochtigheid in de " ~ kamer_name ~ " begint erg hoog te worden, namelijk "~hum~" procent. Buiten is de vochtigheid lager, namelijk "~hum_buiten~" procent dus een raampje open zetten kan helpen en misschien extra ventilatie aanzetten?"
            ] %}
          {%- endif -%}
          {{ hum_check | random }}
        {%- endmacro -%}
        
        {%- macro temp_check(kamer) -%}
          {% set temp_keuken = states.sensor.toon_room_temp.state | int %}
          {% set temp_kamer_lars = states.sensor.temp_kamer_lars.state | int %}
          {% set temp_kamer_nienke = states.sensor.temp_kamer_nienke.state | int %}
          {% set temp_bijkeuken = states.sensor.temp_bijkeuken.state | int %}
          {% set temp_garage = states.sensor.temp_garage.state | int %}
          {% set temp_buiten = states.sensor.br_temperature.state | int %}
          {% if kamer == "woonkamer" %}
            {% set temp = temp_keuken %}
            {% set kamer_name = "woonkamer" %}
          {% elif kamer == "kamer_lars" %} 
            {% set temp = temp_kamer_lars %}
            {% set kamer_name = "kamer van Lars" %}
          {% elif kamer == "kamer_nienke" %} 
            {% set temp = temp_kamer_nienke %}
            {% set kamer_name = "kamer van Nienke" %}
          {% elif kamer == "bijkeuken" %} 
            {% set temp = temp_bijkeuken %}
            {% set kamer_name = "bijkeuken" %}
          {% elif kamer == "garage" %} 
            {% set temp = temp_garage %}
            {% set kamer_name = "garage" %}
          {% elif kamer == "buiten" %} 
            {% set temp = temp_buiten %}
            {% set kamer_name = "omgeving om het huis" %}
          {% endif %} 
          {% if temp < temp_buiten %}
            {% if temp < 0 %}
              {% set temp_check = [
                "De temperatuur in de " ~ kamer_name ~ " begint laag te worden, namelijk "~temp~" graden. Let op bevriezing van de waterleiding!"
              ] %}
            {%- else -%}
              {% set temp_check = [
                "De temperatuur in de " ~ kamer_name ~ " begint hoog te worden, namelijk "~temp~" graden. Buiten is de temperatuur lager, namelijk "~temp_buiten~" graden dus een raampje open zetten kan helpen en misschien extra ventilatie aanzetten?"
              ] %}
            {%- endif -%}
          {%- else -%}
            {% if temp < 0 %}
              {% set temp_check = [
                "De temperatuur in de " ~ kamer_name ~ " begint laag te worden, namelijk "~temp~" graden. Let op bevriezing van de waterleiding!"
              ] %}
            {%- else -%}
              {% set temp_check = [
                "De temperatuur in de " ~ kamer_name ~ " begint hoog te worden, namelijk "~temp~" graden. Buiten is de temperatuur lager, namelijk "~temp_buiten~" graden dus een raampje open zetten kan helpen en misschien extra ventilatie aanzetten?"
              ] %}
            {%- endif -%}
          {%- endif -%}
          {{ temp_check | random }}
        {%- endmacro -%}
        
        {%- macro temp_delta_check(kamer) -%}
          {% set temp_keuken = states.sensor.temp_keuken.state | int %}
          {% set temp_kamer_lars = states.sensor.temp_kamer_lars.state | int %}
          {% set temp_kamer_nienke = states.sensor.temp_kamer_nienke.state | int %}
          {% set temp_bijkeuken = states.sensor.temp_bijkeuken.state | int %}
          {% set temp_garage = states.sensor.temp_garage.state | int %}
          {% set temp_zolder = states.sensor.temp_zolder.state | int %}
          {% set temp_badkamer = states.sensor.temp_badkamer_bad.state | int %}
          {% set temp_buiten = states.sensor.br_temperature.state | int %}
          {% set temp_keuken_stats = states.sensor.keuken_temperature_stats.state | int %}
          {% set temp_kamer_lars_stats = states.sensor.temperatuur_kamer_lars_stats.state | int %}
          {% set temp_kamer_nienke_stats = states.sensor.temperatuur_kamer_nienke_stats.state | int %}
          {% set temp_bijkeuken_stats = states.sensor.temperatuur_bijkeuken_stats.state | int %}
          {% set temp_garage_stats = states.sensor.temperatuur_garage_stats.state | int %}
          {% set temp_zolder_stats = states.sensor.temperatuur_zolder_stats.state | int %}
          {% set temp_badkamer_stats = states.sensor.temperatuur_bad_stats.state | int %}
          {% if kamer == "woonkamer" %}
            {% set temp = temp_keuken %}
            {% set temp_stats = temp_keuken_stats %}
            {% set kamer_name = "woonkamer" %}
          {% elif kamer == "kamer_lars" %} 
            {% set temp = temp_kamer_lars %}
            {% set temp_stats = temp_kamer_lars_stats %}
            {% set kamer_name = "kamer van Lars" %}
          {% elif kamer == "kamer_nienke" %} 
            {% set temp = temp_kamer_nienke %}
            {% set temp_stats = temp_kamer_nienke_stats %}
            {% set kamer_name = "kamer van Nienke" %}
          {% elif kamer == "bijkeuken" %} 
            {% set temp = temp_bijkeuken %}
            {% set temp_stats = temp_bijkeuken_stats %}
            {% set kamer_name = "bijkeuken" %}
          {% elif kamer == "garage" %} 
            {% set temp = temp_garage %}
            {% set temp_stats = temp_garage_stats %}
            {% set kamer_name = "garage" %}
          {% elif kamer == "zolder" %} 
            {% set temp = temp_zolder %}
            {% set temp_stats = temp_zolder_stats %}
            {% set kamer_name = "zolder" %}
          {% elif kamer == "badkamer" %} 
            {% set temp = temp_badkamer %}
            {% set temp_stats = temp_badkamer_stats %}
            {% set kamer_name = "badkamer" %}
          {% elif kamer == "buiten" %} 
            {% set temp = temp_buiten %}
            {% set kamer_name = "omgeving om het huis" %}
          {% endif %} 
          {% if temp-temp_stats > 15 %}
            {% set temp_delta_check = [
              "Alarm! De temperatuur stijgt extreem snel in de " ~ kamer_name ~ ", namelijk de temperatuur is net met " ~ (temp-temp_stats) ~ " graden gestegen."
            ] %}
          {%- else -%}
            {% set temp_delta_check = [
              "De temperatuur stijgt snel in de " ~ kamer_name ~ ", deze is namelijk met " ~ (temp-temp_stats) ~ " graden gestegen."
            ] %}
          {%- endif -%}
          {{ temp_delta_check | random }}
        {%- endmacro -%}  
      
        {# Bathing sentence #}
        {% macro bathing_sentence() -%}
          {% set bathing_sentence = [
            "Ik heb de verwarming in de badkamer en de ventilatie voor je aangezet. Veel plezier in bad.",
            "Ah, Ik zie dat je lekker in bad wilt gaan. De verwarming en de ventilatie heb ik voor je aangezet. Geniet er van.",
            "Ah, je wilt in bad. Goed ik stel alles in om je optimaal te laten genieten van je bad."
          ] %}
          {{bathing_sentence|random}}
        {%- endmacro %}
      
        {# Alarm Google Home sentence #}
        {% macro alarm_google_home_sentence(minutes,voor_of_na,alarm_nr) -%}          
          {% if alarm_nr == 1 %}
            {% set alarm_sentence = states.input_text.alarm1_text.state %}
          {% elif alarm_nr == 2 %} 
            {% set alarm_sentence = states.input_text.alarm2_text.state %}
          {% elif alarm_nr == 3 %} 
            {% set alarm_sentence = states.input_text.alarm3_text.state %}
          {% elif alarm_nr == 4 %} 
            {% set alarm_sentence = states.input_text.alarm4_text.state %}
          {% elif alarm_nr == 5 %} 
            {% set alarm_sentence = states.input_text.alarm5_text.state %}
          {%- endif -%} 
          {% if minutes != 1 %}
            {% set minutes_name = "minuten" %}
          {%- else -%}
            {% set minutes_name = "minuut" %}
          {%- endif -%}
          {% if minutes != 0 %}
            {% if voor_of_na == "voor" %}
              {% set alarm_google_home_sentence = [
                "Over " ~ minutes ~ " " ~ minutes_name ~ " is het zo ver, want dan is het " ~ alarm_sentence ~ ".",
                "Geen nieuwe gevechtjes beginnen want nog " ~ minutes ~ " " ~ minutes_name ~ " en dan is het " ~ alarm_sentence ~ ".",
                "Hebben jullie je tassen, schoenen en jas klaar liggen, want over " ~ minutes ~ " " ~ minutes_name ~ " is het " ~ alarm_sentence ~ ".",
                "Nog " ~ minutes ~ " " ~ minutes_name ~ " om jullie klaar te maken, want het is bijna " ~ alarm_sentence ~ "."
              ] %}
            {%- else -%}
              {% set alarm_google_home_sentence = [
                minutes ~ " " ~ minutes_name ~ " geleden was het al " ~ alarm_sentence ~ ".",
                "Als jullie nu nog op de tablet zitten is het foute boel, want " ~ minutes ~ " " ~ minutes_name ~ " terug was het al tijd " ~ alarm_sentence ~ ".",
                minutes ~ " " ~ minutes_name ~ " eerder was het eigenlijk al " ~ alarm_sentence ~ "."
              ] %}
            {%- endif -%}  
          {%- else -%}  
              {% set alarm_google_home_sentence = [
                "Het is nu zo ver, het is " ~ alarm_sentence ~ ".",
                "Er is echt geen tijd meer over, want het is " ~ alarm_sentence ~ ".",
                "De tablet moet nu echt weggelegd worden, want het is " ~ alarm_sentence ~ ".",
                "Helaas is het afgelopen met spelen en moeten we weg, want het is " ~ alarm_sentence ~ ".",
                "Leg de tablet maar weg want het is " ~ alarm_sentence ~ "."
              ] %}
          {%- endif -%}       
          {{alarm_google_home_sentence|random}}
        {%- endmacro %}           
        
        {# Guests greeting sentence #}
        {% macro guests_greeting_sentence(person) %}
          {% set guests_greeting_sentence = [            
            "Het lijkt erop dat we een gast in huis hebben. Welkom " ~ person ~ ".",
            "We hebben een gast. Ik zal de gastmodus inschakelen. Welkom " ~ person ~ ".",
            "Ik heb de gastmodus ingeschakeld voor het bezoek aan ons huis. Welkom " ~ person ~ ".",
            "Het komt niet zo heel vaak voor dat gasten blijven. Dus laat me het huis voorbereiden op het bezoek van " ~ person ~ ".",
          ] %}
          {{guests_greeting_sentence|random}}
        {% endmacro %}
        
        {%- macro air_quality_check(type) -%}
          {% set nitrogen_dioxide = states.sensor.waqi_nitrogen_dioxide.state | int %}
          {% set ozone = states.sensor.waqi_ozone.state | int %}
          {% set pm_2_5 = states.sensor.waqi_pm_2_5.state | int %}
          {% set pm_10 = states.sensor.waqi_pm_10.state | int %}
          {% set waqi_zevenbergen_brabant = states.sensor.waqi_zevenbergen_brabant.state | int %}
          {% if type == "pm_10" %}
            {% set value = pm_10 %}
            {% set place = "zevenbergen" %}
            {% set type_name = "fijnstof pm10" %}
          {% elif type == "pm_2_5" %} 
            {% set value = pm_2_5 %}
            {% set place = "moerdijk" %}
            {% set type_name = "fijnstof pm2.5" %}
          {% elif type == "ozone" %} 
            {% set value = ozone %}
            {% set place = "breda" %}
            {% set type_name = "ozon" %}
          {% elif type == "nitrogen_dioxide" %} 
            {% set value = nitrogen_dioxide %}
            {% set place = "zevenbergen" %}
            {% set type_name = "stikstof dioxide" %}
          {% endif %}
          {% if value < 100 %}
            {% set air_quality_check = [
              "De luchtkwaliteit buiten begint minder goed te worden. Er wordt in " ~ place ~ " een hogere concentratie " ~ type_name ~ " gemeten, namelijk " ~ value ~ ". De luchtkwaliteit is nog wel acceptabel."
            ] %}
          {% elif value < 150 %}
            {% set air_quality_check = [
              "De luchtkwaliteit buiten begint slecht te worden. Er wordt in " ~ place ~ " een hoge concentratie " ~ type_name ~ " gemeten, namelijk " ~ value ~ ". De luchtkwaliteit begint ongezond te worden voor mensen die daar gevoelig voor zijn."
            ] %}
          {%- else -%}
            {% set air_quality_check = [
              "De luchtkwaliteit buiten begint slecht te worden. Er wordt in " ~ place ~ " een hoge concentratie " ~ type_name ~ " gemeten, namelijk " ~ value ~ ". De luchtkwaliteit is nu echt ongezond voor iedereen, houd daar rekening mee."
            ] %}
          {%- endif -%}
          {{ air_quality_check | random }}
        {%- endmacro -%}
        
        {%- macro pv_production_message() -%}
          {% set pv_production_today = states.sensor.pv_eday.state | float %}          
          {% set pv_production_today_rounded = (1000 * states.sensor.pv_eday.state | float) | round(0) %}
          {% if now().month == 1 %}
            {% set prod_perc = states.input_number.average_electricity_production_jan_perc.state | int %}
            {% set day_count = 31 | int %}
          {% elif now().month == 2 %}
            {% set prod_perc = states.input_number.average_electricity_production_feb_perc.state | int %}
            {% set day_count = 28 | int %}
          {% elif now().month == 3 %}
            {% set prod_perc = states.input_number.average_electricity_production_maa_perc.state | int %}
            {% set day_count = 31 | int %}
          {% elif now().month == 4 %}
            {% set prod_perc = states.input_number.average_electricity_production_apr_perc.state | int %}
            {% set day_count = 30 | int %}
          {% elif now().month == 5 %}
            {% set prod_perc = states.input_number.average_electricity_production_mei_perc.state | int %}
            {% set day_count = 31 | int %}
          {% elif now().month == 6 %}
            {% set prod_perc = states.input_number.average_electricity_production_jun_perc.state | int %}
            {% set day_count = 30 | int %}
          {% elif now().month == 7 %}
            {% set prod_perc = states.input_number.average_electricity_production_jul_perc.state | int %}
            {% set day_count = 31 | int %}
          {% elif now().month == 8 %}
            {% set prod_perc = states.input_number.average_electricity_production_aug_perc.state | int %}
            {% set day_count = 31 | int %}
          {% elif now().month == 9 %}
            {% set prod_perc = states.input_number.average_electricity_production_sep_perc.state | int %}
            {% set day_count = 30 | int %}
          {% elif now().month == 10 %}
            {% set prod_perc = states.input_number.average_electricity_production_okt_perc.state | int %}
            {% set day_count = 31 | int %}
          {% elif now().month == 11 %}
            {% set prod_perc = states.input_number.average_electricity_production_nov_perc.state | int %}
            {% set day_count = 30 | int %}
          {% elif now().month == 12 %}
            {% set prod_perc = states.input_number.average_electricity_production_dec_perc.state | int %}
            {% set day_count = 31 | int %}
          {% endif %}
          {% set pv_production_jaar = states.input_number.average_electricity_production_jaar.state | int %}
          {% set pv_production_month_average = prod_perc / 100 * pv_production_jaar %}
          {% set pv_production_day_average = prod_perc / 100 * pv_production_jaar / day_count %}
          {% set pv_production_diff_day_average = pv_production_today - pv_production_day_average  %}
          {% set pv_production_diff_day_average_perc = 100 * pv_production_diff_day_average | abs / pv_production_day_average  %}
          {% if pv_production_diff_day_average | float > 2 %}
            {% set pv_production_message = [
              "Vandaag hebben de zonnepanelen heel veel electriciteit opgewekt, namelijk " ~ pv_production_today_rounded ~ " watt uur, dat is " ~ pv_production_diff_day_average_perc | round(0) ~ " procent meer dan normaal voor deze maand."
            ] %}
          {% endif %}
          {% if pv_production_diff_day_average | float > 0 and pv_production_diff_day_average | float < 2 %}
            {% set pv_production_message = [
              "Vandaag hebben de zonnepanelen veel electriciteit opgewekt, namelijk " ~ pv_production_today_rounded ~ " watt uur, dat is " ~ pv_production_diff_day_average_perc | round(0) ~ " procent meer dan normaal voor deze maand."
            ] %}
          {% endif %}
          {% if pv_production_diff_day_average | float > -2 and pv_production_diff_day_average | float < 0 %}
            {% set pv_production_message = [
              "Vandaag hebben de zonnepanelen niet zoveel electriciteit opgewekt, namelijk " ~ pv_production_today_rounded ~ " watt uur, dat is " ~ pv_production_diff_day_average_perc | round(0) ~ " procent minder dan normaal voor deze maand."
            ] %}
          {% endif %}
          {% if pv_production_diff_day_average | float > -4 and pv_production_diff_day_average | float < -2 %}
            {% set pv_production_message = [
              "Vandaag hebben de zonnepanelen weinig electriciteit opgewekt, namelijk maar " ~ pv_production_today_rounded ~ " watt uur, dat is " ~ pv_production_diff_day_average_perc | round(0) ~ " procent minder dan normaal voor deze maand."
            ] %}
          {% endif %}
          {% if  pv_production_diff_day_average | float < -4 %}
            {% set pv_production_message = [
              "Vandaag hebben de zonnepanelen zeer weinig electriciteit opgewekt, namelijk maar " ~ pv_production_today_rounded ~ " watt uur, dat is " ~ pv_production_diff_day_average_perc | round(0) ~ " procent minder dan normaal voor deze maand."
            ] %}
          {% endif %}
          {{ pv_production_message | random }}
        {%- endmacro -%}
        
        {# ********************************************* #}
        {#  ******** Start the Speech routines ********  #}
        {# ********************************************* #}
        {% if call_greeting == 1 %}
          {{ greeting() }}
        {% endif %}
        {% if call_no_announcement != 1 %}
          {% if now().strftime('%H')|int < 12 and now().strftime('%H')|int > 5 %}
            {% set goedemorgen = [
              "Goedemorgen."
            ] %}
            {{ goedemorgen|random }}
          {% elif now().strftime('%H')|int >= 12 and now().strftime('%H')|int < 17 %}
            {% set goedemiddag = [
              "Goedemiddag."
            ] %}
            {{ goedemiddag|random }}
          {% else %}
            {% set goedeavond = [
              "Goede avond."
            ] %}
            {{ goedeavond|random }}
          {% endif %}
        {% endif %}       
        
        {% if call_introduction == 1 %}
          {{ introduction() }}
        {% endif %}
        {% if call_update == 1 %}
          {{ update() }}
        {% endif%}
        {% if call_okay == 1 %}
          {{ okay () }}
        {% endif %}
        {% if call_inform == 1 %}
          {{ inform() }}
        {% endif %}
        
        {% if call_location_inquiry == 1 %}
          {% set location = location_inquiry( person, location_not_home() ) %}
          {% set count = location | length %}
          {% if count <= 10 %}
            {{ unknown() }}waar {{ person }} is. {{ witty( error(), chance ) }}
          {% else %}
            {{ location }}
          {% endif %}
        {% endif %}
        
        {% if call_rain_warning == 1 %}
          {{ rain_warning( witty ( bad_weather(), chance ) ) }}
        {% endif %}
        {% if call_langskomen == 1 %}
          {{ langskomen (kind) }}
        {% endif %}
        {% if call_leeslamp_weer_aan == 1 %}
          {{ leeslamp_weer_aan (kind) }}
        {% endif %}
        {{ CustomMessage }}
        {% if call_bye == 1 %}
          {{ bye() }}
        {% endif %}
        {% if call_shut_down == 1 %}
          {{ witty( shut_down(), chance) }}
        {% endif %}
        {% if call_new_device == 1 %}
          {{ new_device( witty( introduction(), chance) ) }}
        {% endif %}
        {% if call_dark_outside == 1 %}
          {{ dark_outside() }}
        {% endif %}
        {% if call_dark_inside == 1 %}
          {{ dark_inside() }}
        {% endif %}
        {% if call_guest_mode_on == 1 %}
          {{ guest_mode_on() }}
        {% endif %}
        {% if call_guest_mode_off == 1 %}
          {{ guest_mode_off() }}
        {% endif %}
        {% if call_responsibilities == 1 %}
          {{ responsibilities() }}
        {% endif %}
        {% if call_inside_weather == 1 %}
          {{ inside_weather() }}
        {% endif %}
        {% if call_outside_weather == 1 %}
          {{ outside_weather(true) }}
        {% endif %}
        {% if call_light_check == 1 %}
          {{ light_check() }}
        {% endif %}
        {% if call_door_check == 1 %}
          {{ door_check() }}
        {% endif %}
        {% if call_door_lock_check == 1 %}
          {{ door_lock_check() }}
        {% endif %}
        {% if call_window_check == 1 or is_state('sun.sun', 'below_horizon') %}
          {{ window_check() }}
        {% endif %}
        {% if call_garage_check == 1 or is_state('sun.sun', 'below_horizon') %}
          {{ garage_check() }}
        {% endif %}
        {% if call_iss == 1 %}
          {{ iss() }}
        {% endif %}
        {% if call_moon == 1 %}
          {{ moon() }}
        {% endif %}
        {% if call_lampen_aan == 1 %}
          {{ lampen_aan (kamer) }}
        {% endif %}
        {% if call_lampen_uit == 1 %}
          {{ lampen_uit (kamer) }}
        {% endif %}
        {% if call_alarm_uit == 1 %}
          {{ alarm_uit() }}
        {% endif %}
        {% if call_firealarm == 1 %}
          {{ firealarm (kamer) }}
        {% endif %}
        {% if call_warning_rain == 1 %}
          {{ warning_rain (kamer) }}
        {% endif %}
        {% if call_work_arrive == 1 %}
          {{ work_arrive (person) }}
        {% endif %}
        {% if call_work_left == 1 %}
          {{ work_left (person) }}
        {% endif %}
        {{holiday_sentence()}}  
        {% if call_briefing == 1 %}
          {{ briefing (person) }}
        {% endif %}
        {% if call_deur_lang_open == 1 %}
          {{ deur_lang_open (deur) }}
        {% endif %}
        {% if call_persoon_vertrokken == 1 %}
          {{ persoon_vertrokken (person) }}
        {% endif %}
        {% if call_persoon_vertrokken_auto == 1 %}
          {{ persoon_vertrokken_auto (person) }}
        {% endif %}
        {% if call_persoon_vertrokken_fiets == 1 %}
          {{ persoon_vertrokken_fiets (person) }}
        {% endif %}
        {% if call_persoon_vertrokken_fiets2 == 1 %}
          {{ persoon_vertrokken_fiets2 (person) }}
        {% endif %}
        {% if call_persoon_vlakbij_winkel == 1 %}
          {{ persoon_vlakbij_winkel (person, shop) }}
        {% endif %}
        {% if call_verbruik_gas == 1 %}
          {{ verbruik_gas () }}
        {% endif %}
        {% if call_verbruik_elec == 1 %}
          {{ verbruik_elec () }}
        {% endif %}
        {% if call_hum_check == 1 %}
          {{ hum_check (kamer) }}
        {% endif %}
        {% if call_temp_check == 1 %}
          {{ temp_check (kamer) }}
        {% endif %}
        {% if call_temp_delta_check == 1 %}
          {{ temp_delta_check (kamer) }}
        {% endif %}  
        {% if call_bathing_sentence == 1 %}
          {{ bathing_sentence () }}
        {% endif %}
        {% if call_alarm_google_home_sentence == 1 %}
          {{ alarm_google_home_sentence (minutes,voor_of_na,alarm_nr) }}
        {% endif %}
        {% if call_guests_greeting_sentence == 1 %}
          {{ guests_greeting_sentence (person) }}
        {% endif %}
        {% if call_air_quality_check == 1 %}
          {{ air_quality_check (type) }}
        {% endif %} 
        {% if call_pv_production_message == 1 %}
          {{ pv_production_message () }}
        {% endif %}    
        {% if call_no_announcement != 1 %} 
          {{ witty( ([iss(), uv(), moon(), outside_weather(true), inspirational_quote()]|random), chance) }}
          {{ witty( ([days_until("Martijn"),days_until("Suzanne"),days_until("Lars"),days_until("Nienke")]|random), 10) }}
          {{ witty( ([days_until_holiday()]|random), 20) }}
        {% endif %}
        
      inline_keyboard: >-
        {{ inline_keyboard }}
        
      text_only: >-
        {{ text_only }}


  - service: input_boolean.turn_off
    data:
      entity_id:
        - input_boolean.janet_alert_mode
        
######################################################################################################
##  janet_notification_hub is the bridge between the speech_engine and the processing units.        ##
######################################################################################################

janet_notification_hub:
  sequence:
  - service: script.janet_speech_processing
    data_template:
      media_player: >-
        {{ media_player }}
      speech_message: >-
        {{ speech_message }}
      text_only: >-
        {{ text_only }}
  - service: script.janet_text_processing 
    data_template:
      speech_message: >-
        {{ speech_message }}
      inline_keyboard: >-
        {{ inline_keyboard }}
  - service: script.janet_text_processing_no_inline_keyboard 
    data_template:
      speech_message: >-
        {{ speech_message }}
      inline_keyboard: >-
        {{ inline_keyboard }}
  - service: script.janet_text_processing_suzanne 
    data_template:
      speech_message: >-
        {{ speech_message }}
      inline_keyboard: >-
        {{ inline_keyboard }}
  - service: script.janet_text_processing_suzanne_no_inline_keyboard 
    data_template:
      speech_message: >-
        {{ speech_message }}
      inline_keyboard: >-
        {{ inline_keyboard }}

######################################################################################################
##                  Within janet_speech_processing the TTS-service is called.                       ##
######################################################################################################

janet_speech_processing:
  sequence:
  - condition: and
    conditions:
      - condition: or
        conditions:
          - condition: time
            after: '07:00:00'
            before: '23:00:00'
          - condition: state
            entity_id: input_boolean.janet_alert_mode
            state: 'on'
      - condition: state
        entity_id: input_boolean.janet_speech_notifications
        state: 'on'        
      - condition: template
        value_template: "{{ text_only | length == 0 }}"
      - condition: or
        conditions:
          - condition: template
            value_template: '{{ states.person.martijn.state == "home" or states.person.suzanne.state == "home" or states.input_boolean.guest.state == "on" }}'
          - condition: state
            entity_id: input_boolean.janet_guest_mode
            state: 'on'
    #TODO
  - wait_template: "{{ not is_state( media_player, 'playing') }}"
    timeout: 00:00:30

  - service: media_player.volume_set
    data_template:
      entity_id: group.google_home_group
      volume_level: >-
        {{ states.input_number.janet_notification_volume.state }}
  - service: tts.google_translate_say
    data_template:
      entity_id: group.google_home_group
      message: >-
        {{ speech_message | replace("\n","") | replace("   ","") | replace("  "," ") }}
      language: nl
#  - service: tts.google_translate_say
#    data_template:
#      message: >-
#          {{ speech_message | replace("\n","") | replace("   ","") | replace("  "," ") }}
#      language: nl
#    entity_id: group.google_home_group   
#  - service: tts.google_translate_say
#    data_template:
#      language: nl
#      entity_id: >
#        {{ media_player }}
#      message: >-
#          {{ speech_message | replace("\n","") | replace("   ","") | replace("  "," ") }}
######################################################################################################
##                  Within janet_text_processing the notify-service is called.                      ##
######################################################################################################

janet_text_processing:
  sequence:
  - condition: template
    value_template: "{{ inline_keyboard | length != 0 }}"
  - condition: state
    entity_id: input_boolean.janet_text_notifications
    state: 'on'
  - condition: template
    value_template: '{{states.input_select.janet_text_notification_target.state != "Suzanne"}}'
  - service: notify.telegram_martijn
    data_template:
      #TODO
      #title: "Janet:"
      message: >-
        {{ speech_message | replace("\n","") | replace("   ","") }}
      data:
        inline_keyboard: >
          {{ inline_keyboard }}
        
######################################################################################################

janet_text_processing_no_inline_keyboard:
  sequence:
  - condition: template
    value_template: "{{ inline_keyboard | length == 0 }}"
  - condition: state
    entity_id: input_boolean.janet_text_notifications
    state: 'on'
  - condition: template
    value_template: '{{states.input_select.janet_text_notification_target.state != "Suzanne"}}'
  - service: notify.telegram_martijn
    data_template:
      #TODO
      #title: "Janet:"
      message: >-
        {{ speech_message | replace("\n","") | replace("   ","") }}

######################################################################################################

janet_text_processing_suzanne:
  sequence:
  - condition: template
    value_template: "{{ inline_keyboard | length != 0 }}"
  - condition: state
    entity_id: input_boolean.janet_text_notifications
    state: 'on'
  - condition: template
    value_template: '{{states.input_select.janet_text_notification_target.state != "Martijn"}}'
  - service: notify.telegram_suzanne
    data_template:
      #TODO
      #title: "Janet:"
      message: >-
        {{ speech_message | replace("\n","") | replace("   ","") }}
      data:
        inline_keyboard: >
          {{ inline_keyboard }}

######################################################################################################

janet_text_processing_suzanne_no_inline_keyboard:
  sequence:
  - condition: template
    value_template: "{{ inline_keyboard | length == 0 }}"
  - condition: state
    entity_id: input_boolean.janet_text_notifications
    state: 'on'
  - condition: template
    value_template: '{{states.input_select.janet_text_notification_target.state != "Martijn"}}'
  - service: notify.telegram_suzanne
    data_template:
      #TODO
      #title: "Janet:"
      message: >-
        {{ speech_message | replace("\n","") | replace("   ","") }}
      
######################################################################################################


######################################################################################################
##    within janet_speech_engine_lars the string message is generated with the use of macro's.           ##
######################################################################################################

janet_speech_engine_lars:
  sequence:
  - service: script.janet_notification_hub_lars
    data_template:
      speech_message: >-
        {%- macro greeting() -%}
          {% set greeting = [
            "Hallo, ",
            "Hey",
            "Hoi ",
            "Hallo daar ",
            "Hi, ",
            "Hai, "
          ] %}
          {{ greeting|random }}
        {%- endmacro -%}
        
        {%- macro weltrusten() -%}
          {% set weltrusten = [
            "Weltrusen.",
            "Lekker slapen jongen.",
            "Fijne nacht.",
            "Ik hoop dat je goed gaat slapen, weltrusten.",
            "Lekker slapen.",
            "Trusten."
          ] %}
          {{ weltrusten|random }}
        {%- endmacro -%}
        
        {%- macro heating_lars() -%}
          {% set heating_lars = [
            "Ik heb de verwarming hier aangezet.",
            "Ik zal het hier eens wat opwarmen.",
            "Verwarming is net aangezet."
          ] %}
          {{ heating_lars|random }}
        {%- endmacro -%}
        
        {%- macro langskomen() -%}
          {% set langskomen = [
            "Ik geef door aan papa en mama dat je wilt dat iemand even langs komt.",
            "Ik geef door dat je graag wilt dat iemand even langs bij je gaat.",
            "Ik geef door dat je het leuk zou vinden als er iemand even langs ging."
          ] %}
          {{ langskomen | random }}
        {%- endmacro -%}
                
        {# ********************************************* #}
        {#  ******** Start the Speech routines ********  #}
        {# ********************************************* #}
        
        {% if call_greeting == 1 %}
          {{ greeting() }}
        {% endif %}
        {% if call_no_announcement != 1 %}
          {% if now().strftime('%H')|int < 12 and now().strftime('%H')|int > 5 %}
            {% set goedemorgen = [
              "Goedemorgen.",
              "Hey goeiemorgen.",
              "Morguh.",
              "Hallo daar, goedemorgen."
            ] %}
            {{ goedemorgen|random }}
            Goedemorgen.
          {% elif now().strftime('%H')|int >= 12 and now().strftime('%H')|int < 17 %}
            {% set goedemiddag = [
              "Goedemiddag.",
              "Hey goededag.",
              "Hallo daar, goeie middag."
            ] %}
            {{ goedemiddag|random }}
          {% else %}
            {% set goedeavond = [
              "Goede avond.",
              "Hallo goedeavond.",
              "Hey daar, goeie avond."
            ] %}
            {{ goedeavond|random }}
            Goedeavond.
          {% endif %}
        {% endif %}   
        {% if call_langskomen == 1 %}
          {{ langskomen () }}
        {% endif %}     
        {% if call_weltrusten == 1 %}
          {{ weltrusten () }}
        {% endif %}        
        {% if call_heating_lars == 1 %}
          {{ heating_lars () }}
        {% endif %}     

######################################################################################################
##  janet_notification_hub_lars is the bridge between the speech_engine and the processing units.        ##
######################################################################################################

janet_notification_hub_lars:
  sequence:
  - service: script.janet_speech_processing_lars
    data_template:
      speech_message: >-
        {{ speech_message }}


######################################################################################################
##                  Within janet_speech_processing_lars the TTS-service is called.                       ##
######################################################################################################

janet_speech_processing_lars:
  sequence:
  - condition: and
    conditions:
      - condition: or
        conditions:
          - condition: time
            after: '07:00:00'
            before: '21:15:00'
          - condition: state
            entity_id: input_boolean.janet_alert_mode
            state: 'on'
      - condition: state
        entity_id: input_boolean.janet_speech_notifications
        state: 'on'        
      - condition: or
        conditions:
          - condition: template
            value_template: '{{ states.person.martijn.state == "home" or states.person.suzanne.state == "home" or states.input_boolean.guest.state == "on" }}'
          - condition: state
            entity_id: input_boolean.janet_guest_mode
            state: 'on'

  - service: media_player.volume_set
    data_template:
      entity_id: media_player.keuken
      volume_level: >-
        {{ states.input_number.janet_notification_volume.state }}
  - service: tts.google_translate_say
    data_template:
      entity_id: media_player.keuken
      message: >-
        {{ speech_message | replace("\n","") | replace("   ","") | replace("  "," ") }}
      language: nl

'1569578493015':
  alias: random_kitchen
  sequence:
  # Check that it Extended Away mode is still on
  - condition: state
    entity_id: input_select.house_mode
    state: 'Extended Away'
    # Wait a random nmber of minutes between 15 and 90 and switch on
  - delay: '"00:{{ (range(15, 90)|random|int) }}:00"'
  - data:
      entity_id:
      - group.lampen_keuken
    service: light.turn_on
    # Wait for between 3 minutes and 9 minutes and switch off
  - delay: '"00:{{ (range(3, 9)|random|int) }}:00"'
  - data:
      entity_id:
      - group.lampen_keuken
    service: light.turn_off
  # Loop the script for next time.
  - service: script.random_kitchen_loop
'1569578623906':
  alias: random_kitchen_loop
  sequence:
  # Stop the calling script
  - service: homeassistant.turn_off
    entity_id: script.random_kitchen
  - delay: 00:05:00

  # Check that Extended Away mode is on and restart the script
  - condition: state
    entity_id: input_select.house_mode
    state: 'Extended Away'
  - service: script.random_kitchen
'15695764564906':
  alias: mockupancy
  sequence:
    # Wait until it is after 6pm and dark to start the routine
    - wait_template: "{{ states.sensor.time.state >= '18:00' and is_state('binary_sensor.dark_outside' , 'on') }}"

    # Check that it Extended Away mode is still on
    - condition: state
      entity_id: input_select.house_mode
      state: 'Extended Away'

    # Pick a random bedtime between 10pm and midnight.
    - service: input_datetime.set_time
      data_template:
        entity_id: input_datetime.mockupancy_bedtime
        time: "{{ (range(22, 23)|random|int) }}:{{ (range(0, 59)|random|int) }}:00"

    # Start the routine, switch on the 'usual' lights
    - data:
        entity_id:
        - group.lampen_woonkamer
      service: light.turn_on

    # Start scripts to randomise occasional lights
    #- service: script.random_master_bedroom
    - service: script.random_kitchen

    # Start scripts to randomise kids' bedtime simulation
    #- service: script.random_guest_room
    #- service: script.random_ashleys_room

    # 1 hour before bedtime, change lighting as if TV was turned off
    - wait_template: "{{ states('sensor.time') == (((state_attr('input_datetime.mockupancy_bedtime' , 'timestamp')) - (60 * 60))|timestamp_custom('%H:%M', false)) }}"
    - data:
        entity_id:
        - group.lampen_entree
        - group.lampen_hal
      service: light.turn_on

    # 20 minutes before bedtime, turn on kitchen lights only
    - wait_template: "{{ states('sensor.time') == (((state_attr('input_datetime.mockupancy_bedtime' , 'timestamp')) - (20 * 60))|timestamp_custom('%H:%M', false)) }}"
    - data:
        entity_id:
        - group.lampen_keuken
      service: light.turn_on

    # Stop kitchen/master bedroom randomisation
    - service: homeassistant.turn_off
      entity_id:
        #- script.random_master_bedroom
        #- script.random_master_bedroom_loop
        - script.random_kitchen
        - script.random_kitchen_loop

    # At 'bedtime', turn on Master Bedroom for random time between 2 and 15 minutes
    # turn off kitchen, wait 20-30 seconds, turn off living room wait 30-59 seconds,
    # turn on bedroom.
    - wait_template: "{{ states('sensor.time') == (state_attr('input_datetime.mockupancy_bedtime' , 'timestamp')|int|timestamp_custom('%H:%M', False)) }}"
    - service: homeassistant.turn_on
      entity_id: group.lampen_hal_boven
    - delay: "00:00:{{ (range(15, 59)|random|int) }}"
    - service: homeassistant.turn_off
      entity_id: group.lampen_woonkamer
    - delay: "00:00:{{ (range(20, 30)|random|int) }}"
    - service: homeassistant.turn_off
      entity_id: group.lampen_keuken
    - delay: "00:00{{ (range(20, 30)|random|int) }}"
    - service: homeassistant.turn_on
      entity_id: group.lampen_slaapkamer
      data:
        brightness: 80
    - delay: "00:{{ (range(2, 15)|random|int) }}:00"
    - service: homeassistant.turn_off
      entity_id: group.lampen_hal_boven
    - delay: "00:{{ (range(15, 59)|random|int) }}:00"
    - service: homeassistant.turn_off
      entity_id: group.lampen_slaapkamer

#    # After a random time between 15 minutes and an hour, turn off the lights
    - delay: "00:{{ (range(15, 30)|random|int) }}:00"
    - data:
        entity_id:
        - group.all_lights
      service: light.turn_off

    # If light before 7am, switch off lights, stop and loop, if not run a further script first
#    - wait_template: "{{ now().hour == 7 }}"
    - wait_template: "{{ states.sensor.time.state == '07:00' }}"
    - service_template: >
        {% if states('binary_sensor.dark_outside' , 'on') %} script.morning_mockupancy
        {% else %} script.mockupancy_loop {% endif %}
'156gdfgfsdfs3015':
  alias: mockupancy_loop
  sequence:
  # Switch off the lights, and make sure the calling scripts have stopped
  - service: homeassistant.turn_off
    entity_id:
      - group.all_lights
      - script.mockupancy
  - delay: 00:05:00

  # Check that it Extended Away mode is still on and restart the script for a new day
  - condition: state
    entity_id: input_select.house_mode
    state: 'Extended Away'
  - service: script.mockupancy
'156gdfgsdfg93015':
  alias: random_master_bedroom
  sequence:
  # Check that it Extended Away mode is still on
  - condition: state
    entity_id: input_select.house_mode
    state: 'Extended Away'
    # Wait a random nmber of minutes between 15 and 90 and switch on
  - delay: '"00:{{ (range(15, 90)|random|int) }}:00"'
  - data:
      entity_id:
      - group.lampen_slaapkamer
    service: light.turn_on
    # Wait for between 3 minutes and 9 minutes and switch off
  - delay: '"00:{{ (range(3, 9)|random|int) }}:00"'
  - data:
      entity_id:
      - group.lampen_slaapkamer
    service: light.turn_off
  # Loop the script for next time.
  - service: script.random_master_bedroom_loop
'15695gsdfgsdfg906':
  alias: random_master_bedroom_loop
  sequence:
  # Stop the calling script
  - service: homeassistant.turn_off
    entity_id: script.random_master_bedroom
  - delay: 00:05:00

  # Check that Extended Away mode is on and restart the script
  - condition: state
    entity_id: input_select.house_mode
    state: 'Extended Away'
  - service: script.random_master_bedroom
'156456456gsdfg906':
  alias: timer_start
  sequence:
    - service: timer.start
      data_template:
        entity_id: timer.cooking_timer
        duration: '{{ states.input_number.timer_hours.state | int }}:{{ states.input_number.timer_minutes.state | int }}:{{ states.input_number.timer_seconds.state | int }}'
'15645fsfssdfg906':
  alias: timer_cancel
  sequence:
    - service: timer.cancel
      data:
        entity_id: timer.cooking_timer
'1564hfghdfgg906':
  alias: extended_away_timer_start
  sequence:
    - service: timer.start
      data_template:
        entity_id: timer.extended_away_timer
        duration: '{{ states.input_number.timer_hours.state | int }}:{{ states.input_number.timer_minutes.state | int }}:{{ states.input_number.timer_seconds.state | int }}'
'1hdfghfghdfgg906':
  alias: extended_away_timer_cancel
  sequence:
    - service: timer.cancel
      data:
        entity_id: timer.extended_away_timer
'156fghdfghdf906':
  alias: kids_home_alone_timer_start
  sequence:
    - service: timer.start
      data_template:
        entity_id: timer.kids_home_alone_timer
        duration: '{{ states.input_number.timer_hours.state | int }}:{{ states.input_number.timer_minutes.state | int }}:{{ states.input_number.timer_seconds.state | int }}'
'1566546346dfg906':
  alias: kids_home_alone_timer_cancel
  sequence:
    - service: timer.cancel
      data:
        entity_id: timer.kids_home_alone_timer
'15645634563456dfg906':
  alias: guests_timer_start
  sequence:
    - service: timer.start
      data_template:
        entity_id: timer.guests_timer
        duration: '{{ states.input_number.timer_hours.state | int }}:{{ states.input_number.timer_minutes.state | int }}:{{ states.input_number.timer_seconds.state | int }}'
'15634563456g906':
  alias: guests_timer_cancel
  sequence:
    - service: timer.cancel
      data:
        entity_id: timer.guests_timer
'156456345fsdfsfsf':
  alias: fan_timer_start
  sequence:
    - service: timer.start
      data_template:
        entity_id: timer.fan_on_timer
        duration: '{{ states.input_number.timer_hours.state | int }}:{{ states.input_number.timer_minutes.state | int }}:{{ states.input_number.timer_seconds.state | int }}'
'156345637575675':
  alias: fan_timer_cancel
  sequence:
    - service: timer.cancel
      data:
        entity_id: timer.fan_on_timer
        
        
